# Phase 1, Step 3: Head Node OS Installation

* **File:** 1.3-almalinux-install.md
* **Date:** December 18, 2025
* **Target:** Node 01 (Head Node)
* **OS:** AlmaLinux 9.x
* **Hardware:** Supermicro X10 "Twin" (2x Xeon E5-2630 v4)
* **Storage Config:** Dual-Drive (SATA Boot + NVMe Data)

---

## 1. BIOS Configuration (Pre-Flight)

Before booting the installation media, ensure the Supermicro X10 BIOS is configured correctly.

* **Boot Mode:** **UEFI** (Disable Legacy/CSM).
* **PCIe Configuration:** Enable **Above 4G Decoding** (Critical for NVMe support).
* **SATA Mode:** **AHCI**.
  * **_Note_**: Do not use "Intel RST/RAID".

---

## 2. Installation Procedure

Boot from the AlmaLinux 9 installation media. Select **"Install AlmaLinux 9"**.

### A. Localization

* **Language:** English (United States).
* **Time & Date:** Select local timezone (e.g., New York).
  * **_Tip_**: Toggle **Network Time** to **ON** (top right).

### B. Software Selection (Critical)

* **Base Environment:** **Minimal Install**.
* **Add-Ons:** None.

### C. Partitioning (Installation Destination)

Select **BOTH** the SATA SSD and the NVMe drive. Choose **Custom** storage configuration. Click **Done**.

**Strategy:**

* **Drive 1 (SATA):** Holds the OS, Logs, and Warewulf Images.
* **Drive 2 (NVMe):** Dedicated strictly to `/home` to maximize NFS throughput.

**Partition Layout:**

| Drive | Mount Point | Size | Filesystem | Rationale |
| :--- | :--- | :--- | :--- | :--- |
| **SATA** | `/boot/efi` | 600 MiB | EFI System | UEFI Boot loader. |
| **SATA** | `/boot` | 1 GiB | XFS | Kernel storage. |
| **SATA** | `swap` | 8 GiB | Swap | Safety net for RAM overflows. |
| **SATA** | `/` (Root) | **Max Allowed** | XFS | Uses the rest of the SATA drive. ample space for OS + Warewulf images (`/var/lib/warewulf`). |
| **NVMe** | `/home` | **Max Allowed** | XFS | Uses 100% of the NVMe drive. Ensures user I/O saturates the 10GbE link. |

_Note: If the installer asks, ensure the Boot Loader is installed to the SATA drive._

### D. Network & Hostname

* **Hostname:** `node01` (Set in the bottom left text box and click Apply).
* **Interface Configuration:**
  * Identify the primary interface (likely `eno1`).
  * **Do not configure the LACP Bond yet.**
  * Configure `eno1` with a temporary static IP (IPv4).
  * **Activate:** Toggle the switch to **ON**.

### E. User Settings

* **Root Password:** Set a strong root password.
* **User Creation:** Create a primary admin user.
  * **Username:** `eal`
  * Check **"Make this user administrator"** (Adds to wheel group for sudo access).

Click **Begin Installation**.

---

## 3. Post-Installation Configuration

After the installation completes, reboot the system and log in as `root`.

### A. System Update

    dnf -y update

### B. Enable CodeReady Builder (CRB)

OpenHPC 3.x on EL9 relies on the CRB repository (formerly PowerTools in EL8) for build dependencies like hwloc.

    dnf config-manager --set-enabled crb

### C. Install EPEL

The "Extra Packages for Enterprise Linux" repository provides standard admin tools not found in the base OS.

    dnf -y install epel-release

### D. Install OpenHPC Repository

Install the release RPM to define the OpenHPC 3.x repositories.

    dnf -y install http://repos.openhpc.community/OpenHPC/3/EL_9/x86_64/ohpc-release-3-1.el9.x86_64.rpm

### E. Install Open OnDemand Repository

We add the repository now so the package is available for installation in Phase 2.

    dnf install -y https://yum.osc.edu/ondemand/3.1/ondemand-release-web-3.1-1.el9.noarch.rpm

### F. Configure SSL Certificates (Self-Signed)

Open OnDemand requires HTTPS. We generate a self-signed certificate now to avoid configuration errors later.

    mkdir -p /etc/pki/tls/private
    mkdir -p /etc/pki/tls/certs

    openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
      -keyout /etc/pki/tls/private/localhost.key \
      -out /etc/pki/tls/certs/localhost.crt \
      -subj "/C=US/ST=Ohio/L=Athens/O=PhysicsLab/CN=$(hostname)"

### G. Configure Firewall

We must open the standard web ports (80/443) to allow users to access the portal.

    firewall-cmd --permanent --add-service=http
    firewall-cmd --permanent --add-service=https
    firewall-cmd --reload

### H. Reboot

Perform one final reboot to ensure you are running the latest kernel installed during step 3A.

    reboot
