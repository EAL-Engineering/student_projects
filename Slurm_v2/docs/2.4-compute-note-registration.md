# Phase 2, Step 4: Compute Node Registration

* **File:** `2.4-node-registration.md`
* **Date:** December 10, 2025
* **Target:** Node 01 (Head Node)
* **Software:** Warewulf 4.x, ipmitool
* **Goal:** Define the physical compute nodes (Nodes 02â€“04) in the Warewulf database and map them to their specific IP and MAC addresses.

---

## 1. Overview

With the VNFS image built (Step 2.2) and the Network Overlays configured (Step 2.3), we must now register the actual hardware.

We will add three compute nodes: `node02`, `node03`, and `node04`. These nodes will be configured to:

1. Boot via PXE (using the MAC address of their primary interface).
2. Receive a static IP assignment (mapped to the bond interface created in the overlay).
3. Inherit the `default` profile settings (Kernel + Container + Overlays).

**Prerequisites:** You must have the MAC address for the primary 10GbE interface (`eno1`) of each Supermicro node.

## 2. Node Naming & Addressing Scheme

Consistent naming is vital for Slurm and host resolution. We will follow the schema defined in the Project Plan, using the MAC addresses identified in the hardware inventory.

**Physical Orientation (Rear View):**
Based on the visual labels in the rack diagram (`backofbrik.jpg`), the nodes are arranged as follows:

    -------------------------
    |  Node D   |  Node B   |
    | (Node 04) | (Node 02) |
    -------------------------
    |  Node C   |  Node A   |
    | (Node 03) | (Node 01) |
    -------------------------

**Registration Table:**
(Note: Source Node locations revised to match the chassis image labels).

| Node Name | Role | IP Address | Hardware (MAC) Address | Source Node |
| :--- | :--- | :--- | :--- | :--- |
| **node02** | Compute | 10.0.0.92 | `AC:1F:6B:C4:C4:66` | Node B (Top Right) |
| **node03** | Compute | 10.0.0.93 | `AC:1F:6B:59:A0:B6` | Node C (Bottom Left) |
| **node04** | Compute | 10.0.0.94 | `AC:1F:6B:5A:BD:04` | Node D (Top Left) |

## 3. Registering Nodes

Use `wwctl` to add the nodes to the database. We explicitly set the IP address here so that the Warewulf template engine can inject it into the `bond0.nmconnection.ww` overlay we created in Step 2.3.

Register Node 02:

    sudo wwctl node add node02 --ipaddr 10.0.0.92 --hwaddr AC:1F:6B:C4:C4:66

Register Node 03:

    sudo wwctl node add node03 --ipaddr 10.0.0.93 --hwaddr AC:1F:6B:59:A0:B6

Register Node 04:

    sudo wwctl node add node04 --ipaddr 10.0.0.94 --hwaddr AC:1F:6B:5A:BD:04

## 4. Configuring IPMI

Since these are Supermicro X10 "Twin" nodes, they have dedicated IPMI (BMC) interfaces. Configuring this in Warewulf allows you to issue power commands (e.g., `wwctl power cycle node02`) directly from the Head Node.

**Assumption:** IPMI interfaces are on the `10.0.0.1xx` range.

Configure IPMI settings for all nodes:

    sudo wwctl node set node02 --ipmiaddr 10.0.0.102 --ipmiuser ADMIN --ipmipass ADMIN
    sudo wwctl node set node03 --ipmiaddr 10.0.0.103 --ipmiuser ADMIN --ipmipass ADMIN
    sudo wwctl node set node04 --ipmiaddr 10.0.0.104 --ipmiuser ADMIN --ipmipass ADMIN

## 5. Verify Configuration

Before attempting a boot, verify that the nodes are correctly associated with the `default` profile (which contains the `almalinux-9-hpc` container and `lacp-bond` overlay).

List all nodes and their profiles:

    sudo wwctl node list -a

**Expected Output:**
Ensure that the `Profiles` column lists `default` for all three nodes.

## 6. Persist Changes

Warewulf requires a configuration reload to update the underlying TFTP and HTTP provisioners with the new node data.

Reload Warewulf configuration:

    sudo wwctl configure --all

## 7. Next Steps: Booting & Monitoring

The cluster logic is now fully defined. The nodes are registered, the image is ready, and the network configuration is staged.

1. **Physical Boot:** Manually power on Node 02.
2. **Monitor Boot:** Watch the console to see the PXE pull and the Linux kernel initialization.

### Monitoring Options

**Option A: IPMI Serial Over LAN (SOL)**
This is the preferred method for remote administration. You can view the node's boot output directly from the Head Node terminal without needing physical access.

    # Syntax: ipmitool -I lanplus -H <IPMI_IP> -U <USER> -P <PASS> sol activate
    ipmitool -I lanplus -H 10.0.0.102 -U ADMIN -P ADMIN sol activate

* **To Exit SOL:** Type `~.` (tilde followed by a period).

**Option B: Physical VGA**
You can simply plug a monitor and keyboard into the VGA port on the specific node chassis (Node B/Top Right) to view the output directly.

**Option C: Warewulf Power Command**
If IPMI is configured correctly (Section 4), you can cycle power directly via Warewulf:

    sudo wwctl power cycle node02

## 8. Troubleshooting

* **"Node not found" during PXE:** Double-check the MAC address entered in Step 3 matches the interface requesting the DHCP lease.
* **Overlay not applying:** Ensure `wwctl overlay list` shows the `lacp-bond` overlay, and that it is assigned to the `default` profile.