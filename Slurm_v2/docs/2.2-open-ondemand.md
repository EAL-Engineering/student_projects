# Phase 2, Step 2: Installing Open OnDemand

* **File:** `2.2-open-ondemand.md`
* **Date:** December 18, 2025
* **Target:** Node 01 (Head Node)
* **Software:** Open OnDemand 3.1
* **Prerequisites:** Phase 2.1 (Slurm Controller active), Phase 1.3 (SSL Certs & Firewall configured)
* **Goal:** Install and configure the web portal service on the Head Node.

---

## 1. Overview

With the Slurm Controller active, we can now install the Open OnDemand (OOD) portal. This service runs on the Head Node and communicates directly with the local Slurm daemon to submit and monitor jobs.

## 2. Install Packages

Since the repositories were added during the OS installation (Phase 1.3), we can install the application directly.

    dnf install ondemand ondemand-selinux

## 3. Configuration

### 3.1 Portal Configuration (SSL)

We configure the portal to use the system certificates generated in Phase 1.3.

Edit `/etc/ood/config/ood_portal.yml`:

    servername: null
    ssl:
      - 'SSLCertificateFile "/etc/pki/tls/certs/localhost.crt"'
      - 'SSLCertificateKeyFile "/etc/pki/tls/private/localhost.key"'
    auth:
      - 'AuthType Basic'
      - 'AuthName "Open OnDemand"'
      - 'AuthUserFile "/etc/apache2/.htpasswd"'

*Note: We are using Basic Auth for simplicity.*

### 3.2 Cluster Definition

We must tell OOD how to talk to the local Slurm controller.

Create `/etc/ood/config/clusters.d/my_cluster.yml`:

    v2:
      metadata:
        title: "Nuclear Physics Cluster"
      login:
        host: "localhost"
      job:
        adapter: "slurm"
        cluster: "cluster"
        bin: "/usr/bin"
        conf: "/etc/slurm/slurm.conf"
      batch_connect:
        basic:
          script_wrapper: "module purge\n%s"
        vnc:
          script_wrapper: "module purge\n%s"

## 4. Apply Changes & Start Services

Generate the Apache configuration and start the services.

    # Update Apache config based on ood_portal.yml
    /opt/ood/ood-portal-generator/sbin/update_ood_portal

    # Enable and Start Apache HTTPD
    systemctl enable --now httpd

    # Enable and Start OOD PUN Service
    systemctl enable --now ondemand-dex

## 5. Next Steps

The web portal is now active (though the compute nodes it talks to are not yet provisioned). We now proceed to building the operating system image for the compute nodes.

Proceed to **2.3-master-image.md**.
